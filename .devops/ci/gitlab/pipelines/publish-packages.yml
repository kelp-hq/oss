publish-to-anagolay-registry:
  extends:
    - .install-pnpm-and-node
  stage: publish
  needs: ['bump-versions']
  cache: {}
  allow_failure: true
  # when: manual
  variables:
    NPM_REGISTRY_URL: npm-registry.anagolay.network
    # GIT_STRATEGY: clone # we need fresh code so we don't add the merge config to the gitconfig
    GIT_CLEAN_FLAGS: -ffd
  script:
    - set e
    - !reference [.rush:install, script]
    - !reference [.rush:retest, script]

    - node common/scripts/install-run-rush.js publish --apply --publish --add-commit-details --include-all --target-branch $CI_COMMIT_REF_NAME --add-commit-details --set-access-level public
# publish-to-npm-registry:
#   extends:
#     - .install-pnpm-and-node
#   stage: publish
#   needs: ['bump-versions']
#   cache: {}
#   allow_failure: true
#   when: manual
#   variables:
#     NPM_REGISTRY_URL: registry.npmjs.org
#   script:
#     - set e
#     - !reference [.rush:install, script]
#     - !reference [.rush:retest, script]

#     - node common/scripts/install-run-rush.js publish --apply --publish --add-commit-details --include-all --target-branch $CI_COMMIT_REF_NAME --add-commit-details --set-access-level public --registry https://registry.npmjs.org/
